(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function l(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=l(i);fetch(i.href,r)}})();const w={};window.addEventListener("keydown",e=>{w[e.code]=!0,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space"].includes(e.code)&&e.preventDefault()});window.addEventListener("keyup",e=>{w[e.code]=!1});function we(e){const t=document.getElementById("touch-controls");function l(){t&&(t.style.display="flex")}e.addEventListener("touchstart",a=>{a.preventDefault(),l(),window.dispatchEvent(new KeyboardEvent("keydown",{code:""}))},{passive:!1,once:!0}),e.addEventListener("touchstart",a=>{a.preventDefault(),window.dispatchEvent(new KeyboardEvent("keydown",{code:""}))},{passive:!1}),t&&t.querySelectorAll(".touch-btn").forEach(i=>{const r=i.dataset.key;r&&(i.addEventListener("touchstart",n=>{n.preventDefault(),n.stopPropagation(),l(),w[r]=!0,window.dispatchEvent(new KeyboardEvent("keydown",{code:r}))},{passive:!1}),i.addEventListener("touchend",n=>{n.preventDefault(),n.stopPropagation(),w[r]=!1},{passive:!1}),i.addEventListener("touchcancel",n=>{n.preventDefault(),w[r]=!1},{passive:!1}))})}function v(e,t){return e.x<t.x+t.w&&e.x+e.w>t.x&&e.y<t.y+t.h&&e.y+e.h>t.y}function De(e,t,l){let a=performance.now();function i(r){const n=Math.min((r-a)/1e3,.05);a=r,t(n),l(e),requestAnimationFrame(i)}requestAnimationFrame(i)}const le=130,Be=-280,ve=800,oe=500,he=2;function q(e,t){return{x:e,y:t,vx:0,vy:0,w:14,h:16,onGround:!1,alive:!0,facingRight:!0,gravityDir:1,animFrame:0,animTimer:0,jumpsLeft:he,jumpPressed:!1,boostVx:0}}function ke(e,t,l){if(!e.alive)return;e.vx=0,(w.ArrowLeft||w.KeyA)&&(e.vx=-le,e.facingRight=!1),(w.ArrowRight||w.KeyD)&&(e.vx=le,e.facingRight=!0),Math.abs(e.boostVx)>10?(e.vx+=e.boostVx,e.boostVx*=.92):e.boostVx=0;const a=w.Space||w.ArrowUp||w.KeyW;a&&!e.jumpPressed&&e.jumpsLeft>0&&(e.vy=Be*e.gravityDir,e.onGround=!1,e.jumpsLeft--,e.jumpPressed=!0),a||(e.jumpPressed=!1),e.vy+=ve*e.gravityDir*t,e.vy=Math.max(-oe,Math.min(oe,e.vy)),e.x+=e.vx*t;const i=()=>({x:e.x,y:e.y,w:e.w,h:e.h});for(const r of l)v(i(),r)&&(e.vx>0?e.x=r.x-e.w:e.vx<0&&(e.x=r.x+r.w));e.y+=e.vy*t,e.onGround=!1;for(const r of l)v(i(),r)&&(e.gravityDir===1?e.vy>0?(e.y=r.y-e.h,e.onGround=!0):e.vy<0&&(e.y=r.y+r.h):e.vy<0?(e.y=r.y+r.h,e.onGround=!0):e.vy>0&&(e.y=r.y-e.h),e.vy=0);e.onGround&&(e.jumpsLeft=he),e.vx!==0&&e.onGround?(e.animTimer+=t,e.animTimer>.15&&(e.animTimer=0,e.animFrame=(e.animFrame+1)%4)):(e.animFrame=0,e.animTimer=0),(e.y>300||e.y<-50)&&(e.alive=!1)}const Z=[{name:"Kolay, değil mi?",subtitle:"Bu kadar kolay olamaz...",playerStart:{x:20,y:220},doorPos:{x:440,y:222},platforms:[{x:0,y:250,w:200,h:20},{x:200,y:250,w:40,h:20},{x:250,y:250,w:40,h:20},{x:300,y:250,w:40,h:20},{x:350,y:250,w:40,h:20},{x:400,y:250,w:80,h:20},{x:220,y:190,w:60,h:10},{x:320,y:160,w:60,h:10},{x:0,y:0,w:10,h:270},{x:470,y:0,w:10,h:270},{x:0,y:0,w:480,h:10}],traps:[{type:"collapse",rect:{x:200,y:250,w:40,h:20},delay:.5},{type:"collapse",rect:{x:250,y:250,w:40,h:20},delay:.5},{type:"collapse",rect:{x:300,y:250,w:40,h:20},delay:.5},{type:"collapse",rect:{x:350,y:250,w:40,h:20},delay:.5}],killZones:[]},{name:"Dur, nereye?",subtitle:"Kapı nereye gitti?!",playerStart:{x:20,y:220},doorPos:{x:440,y:222},platforms:[{x:0,y:250,w:120,h:20},{x:160,y:250,w:80,h:20},{x:290,y:250,w:90,h:20},{x:400,y:250,w:80,h:20},{x:100,y:200,w:50,h:10},{x:40,y:155,w:60,h:10},{x:15,y:110,w:70,h:10},{x:180,y:170,w:60,h:10},{x:280,y:140,w:60,h:10},{x:370,y:170,w:50,h:10},{x:340,y:210,w:70,h:10},{x:0,y:0,w:10,h:270},{x:470,y:0,w:10,h:270},{x:0,y:0,w:480,h:10}],traps:[{type:"moveDoor",rect:{x:420,y:0,w:60,h:270},target:{x:30,y:86}},{type:"moveDoor",rect:{x:10,y:0,w:80,h:270},target:{x:355,y:186}},{type:"moveDoor",rect:{x:330,y:0,w:90,h:270},target:{x:440,y:226}},{type:"spike",rect:{x:180,y:240,w:12,h:10}},{type:"spike",rect:{x:310,y:240,w:12,h:10}}],killZones:[]},{name:"Dikkat et!",subtitle:"Görünen köy kılavuz istemez... mi?",playerStart:{x:20,y:220},doorPos:{x:440,y:222},platforms:[{x:0,y:250,w:60,h:20},{x:60,y:250,w:40,h:20},{x:100,y:250,w:30,h:20},{x:130,y:250,w:50,h:20},{x:180,y:250,w:40,h:20},{x:220,y:250,w:40,h:20},{x:260,y:250,w:50,h:20},{x:310,y:250,w:30,h:20},{x:340,y:250,w:50,h:20},{x:400,y:250,w:80,h:20},{x:50,y:200,w:45,h:10},{x:120,y:170,w:50,h:10},{x:200,y:145,w:50,h:10},{x:280,y:165,w:50,h:10},{x:360,y:190,w:50,h:10},{x:155,y:210,w:50,h:10},{x:300,y:200,w:50,h:10},{x:0,y:0,w:10,h:270},{x:470,y:0,w:10,h:270},{x:0,y:0,w:480,h:10}],traps:[{type:"spike",rect:{x:70,y:240,w:12,h:10}},{type:"spike",rect:{x:88,y:240,w:12,h:10}},{type:"spike",rect:{x:140,y:240,w:12,h:10}},{type:"spike",rect:{x:158,y:240,w:12,h:10}},{type:"spike",rect:{x:190,y:240,w:12,h:10}},{type:"spike",rect:{x:230,y:240,w:12,h:10}},{type:"spike",rect:{x:275,y:240,w:12,h:10}},{type:"spike",rect:{x:295,y:240,w:12,h:10}},{type:"spike",rect:{x:350,y:240,w:12,h:10}},{type:"spike",rect:{x:370,y:240,w:12,h:10}},{type:"spike",rect:{x:160,y:200,w:12,h:10}},{type:"spike",rect:{x:338,y:190,w:12,h:10}}],killZones:[]},{name:"Acele et!",subtitle:"Yavaş olan kaybeder...",playerStart:{x:20,y:220},doorPos:{x:440,y:222},platforms:[{x:0,y:250,w:80,h:20},{x:80,y:250,w:60,h:20},{x:140,y:250,w:60,h:20},{x:200,y:250,w:60,h:20},{x:260,y:250,w:60,h:20},{x:400,y:250,w:80,h:20},{x:120,y:190,w:60,h:10},{x:260,y:160,w:60,h:10},{x:0,y:0,w:10,h:270},{x:470,y:0,w:10,h:270},{x:0,y:0,w:480,h:10}],traps:[{type:"collapse",rect:{x:80,y:250,w:60,h:20},delay:.3},{type:"collapse",rect:{x:140,y:250,w:60,h:20},delay:.3},{type:"collapse",rect:{x:200,y:250,w:60,h:20},delay:.3},{type:"collapse",rect:{x:260,y:250,w:60,h:20},delay:.3},{type:"boost",rect:{x:55,y:240,w:20,h:10}},{type:"spike",rect:{x:350,y:240,w:12,h:10}},{type:"spike",rect:{x:375,y:240,w:12,h:10}}],killZones:[]},{name:"Son adım",subtitle:"Her şey burada bitiyor...",playerStart:{x:20,y:220},doorPos:{x:440,y:222},platforms:[{x:0,y:250,w:480,h:20},{x:300,y:200,w:60,h:10},{x:100,y:180,w:60,h:10},{x:250,y:140,w:60,h:10},{x:400,y:100,w:70,h:10},{x:0,y:0,w:10,h:270},{x:470,y:0,w:10,h:270},{x:0,y:0,w:480,h:10}],traps:[{type:"spike",rect:{x:180,y:240,w:12,h:10}},{type:"spike",rect:{x:220,y:240,w:12,h:10}},{type:"fakeExit",rect:{x:315,y:203,w:16,h:24}},{type:"moveDoor",rect:{x:410,y:0,w:70,h:270},target:{x:420,y:76}}],killZones:[]}],s={bg:"#f2e8dc",platform:"#c4697a",platformLight:"#d4849a",player:"#2d2d3a",playerHeart:"#e05577",gold:"#d4a054",princess:"#d4849a",spike:"#8b3a4a",door:"#a0785a",doorFrame:"#8b6f4e",doorOpen:"#3a3028",text:"#2d2d3a",textDim:"rgba(45,45,58,0.5)"},j=2;function Me(e,t,l,a,i,r){e.fillStyle=r,e.fillRect(t+a*j,l+i*j,j,j)}function de(e,t,l,a,i){for(let r=0;r<a.length;r++)for(let n=0;n<a[r].length;n++){const o=a[r][n];if(o===" "||o===".")continue;const y=i[o];y&&Me(e,t,l,n,r,y)}}const be={B:s.player,H:s.playerHeart},J=["..BBB..","..BBB..",".BBBBB.",".BBHBB.",".BBBBB.","..BBB..","..B.B..","..B.B.."],Re=["..BBB..","..BBB..",".BBBBB.",".BBHBB.",".BBBBB.","..BBB..",".BB..B.","BB...BB"],Se=["..BBB..","..BBB..",".BBBBB.",".BBHBB.",".BBBBB.","..BBB..","..B.BB.","..B..BB"],Ae=["..BBB..","..BBB..",".BBBBB.",".BBHBB.",".BBBBB.","..BBB..","..BBB..","......."];function Te(e){if(!e.onGround)return Ae;switch(e.animFrame){case 0:return J;case 1:return Re;case 2:return J;case 3:return Se;default:return J}}function Pe(e){return e.map(t=>t.split("").reverse().join(""))}function V(e,t){if(!t.alive)return;let l=Te(t);t.facingRight||(l=Pe(l)),de(e,t.x,t.y,l,be)}const Ee={D:s.princess,G:s.gold},Le=["..GGG..","..DDD..","..DDD..",".DDDDD.",".DDDDD.",".DDDDD.","DDDDDDD","......."],re=["..GGG.D","..DDD.D","..DDD..",".DDDDD.",".DDDDD.",".DDDDD.","DDDDDDD","......."],Ge=["..GGG..","..DDD..","..DDDDD",".DDDDD.",".DDDDD.",".DDDDD.","DDDDDDD","......."],ae=[Le,re,Ge,re];function F(e,t,l,a){const i=ae[a%ae.length];de(e,t,l,i,Ee)}function C(e,t){e.fillStyle=s.platform,e.fillRect(t.x,t.y,t.w,t.h),e.fillStyle=s.platformLight,e.fillRect(t.x,t.y,t.w,1)}function ie(e,t,l,a){e.fillStyle=s.spike;const i=12,r=10,n=t+i/2;e.beginPath(),e.moveTo(n,l),e.lineTo(t,l+r),e.lineTo(t+i,l+r),e.closePath(),e.fill()}function $(e,t,l,a){a?(e.fillStyle=s.doorOpen,e.fillRect(t,l,16,24),e.fillStyle=s.doorFrame,e.fillRect(t,l,1,24),e.fillRect(t+16-1,l,1,24),e.fillRect(t,l,16,1)):(e.fillStyle=s.door,e.fillRect(t,l,16,24),e.fillStyle=s.doorFrame,e.fillRect(t,l,16,1),e.fillRect(t,l,1,24),e.fillRect(t+16-1,l,1,24),e.fillRect(t,l+24-1,16,1))}function W(e,t,l,a,i){if(e.fillStyle=i,a<=2)e.fillRect(t+1,l,2,1),e.fillRect(t+5,l,2,1),e.fillRect(t,l+1,8,1),e.fillRect(t+1,l+2,6,1),e.fillRect(t+2,l+3,4,1),e.fillRect(t+3,l+4,2,1);else if(a<=4)e.fillRect(t+1,l,2,1),e.fillRect(t+4,l,2,1),e.fillRect(t,l+1,7,1),e.fillRect(t,l+2,7,1),e.fillRect(t+1,l+3,5,1),e.fillRect(t+2,l+4,3,1),e.fillRect(t+3,l+5,1,1);else{const r=Math.floor(a/3);e.fillRect(t+1*r,l,2*r,r),e.fillRect(t+4*r,l,2*r,r),e.fillRect(t,l+1*r,7*r,r),e.fillRect(t,l+2*r,7*r,r),e.fillRect(t+1*r,l+3*r,5*r,r),e.fillRect(t+2*r,l+4*r,3*r,r),e.fillRect(t+3*r,l+5*r,1*r,r)}}function Ie(e,t,l,a,i,r){const n=.6+Math.sin(r*.1)*.4;e.fillStyle=s.gold,e.globalAlpha=n,e.fillRect(t,l,a,i),e.fillStyle="#fff",e.globalAlpha=n*.8;const o=l+i/2;e.beginPath(),e.moveTo(t+4,o-3),e.lineTo(t+8,o),e.lineTo(t+4,o+3),e.fill(),e.beginPath(),e.moveTo(t+10,o-3),e.lineTo(t+14,o),e.lineTo(t+10,o+3),e.fill(),e.globalAlpha=1}function N(e,t,l){e.fillStyle="rgba(0, 0, 0, 0.02)";for(let i=0;i<l;i+=2)e.fillRect(0,i,t,1);const a=e.createRadialGradient(t/2,l/2,Math.min(t,l)*.4,t/2,l/2,Math.max(t,l)*.7);a.addColorStop(0,"rgba(0, 0, 0, 0)"),a.addColorStop(1,"rgba(0, 0, 0, 0.15)"),e.fillStyle=a,e.fillRect(0,0,t,l)}const ne=["Ahhh! Tekrar dene, aşkım bekliyor!","Bu sefer olacak... belki.","Işıl bunu görse gülmekten kırılırdı.","Pes etme! Aşk engel tanımaz... ama dikenler tanır.","404: Hayatta kalma becerisi bulunamadı","Bir daha! Aşk sabır ister...","Bu oyun seni trollüyor ama aşk gerçek!","Merak etme, Işıl hâlâ bekliyor","Düşmek normal, kalkmak aşk!"],H=5;function Fe(e,t,l,a){e.fillStyle=a,e.fillRect(t+1,l,3,1),e.fillRect(t,l+1,5,1),e.fillRect(t,l+2,1,1),e.fillRect(t+2,l+2,1,1),e.fillRect(t+4,l+2,1,1),e.fillRect(t+1,l+3,3,1),e.fillRect(t+1,l+4,1,1),e.fillRect(t+3,l+4,1,1)}function He(e,t,l,a,i){e.fillStyle=i,e.fillRect(t,l-a,1,a*2+1),e.fillRect(t-a,l,a*2+1,1),a>=2&&(e.fillRect(t-1,l-1,1,1),e.fillRect(t+1,l-1,1,1),e.fillRect(t-1,l+1,1,1),e.fillRect(t+1,l+1,1,1))}function Ce(e,t,l,a){e.save(),e.textAlign="center",e.textBaseline="middle",e.fillStyle=s.text,e.font="bold 20px monospace",e.fillText("Işıl’a Ulaş",t/2,l/2-50),e.fillStyle=s.playerHeart,e.fillRect(t/2-40,l/2-34,80,1),e.fillStyle=s.textDim,e.font="9px monospace",e.fillText("Sana ulaşmak bu kadar zor olmamalıydı...",t/2,l/2-18),W(e,t/2-4,l/2-2,3,s.playerHeart);const i=Math.abs(Math.sin(a*.05));e.globalAlpha=.3+i*.7,e.fillStyle=s.gold,e.font="9px monospace",e.fillText("Başlamak için bir tuşa bas",t/2,l/2+30),e.globalAlpha=1,e.restore()}function Oe(e,t,l,a,i){e.save(),e.fillStyle="rgba(242, 232, 220, 0.85)",e.fillRect(0,0,t,l),e.textAlign="center",e.textBaseline="middle",e.fillStyle=s.text,e.font="11px monospace",e.fillText(a,t/2,l/2-15),e.fillStyle=s.playerHeart,e.font="9px monospace",e.fillText("☠ "+i,t/2,l/2+10),e.fillStyle=s.textDim,e.font="8px monospace",e.fillText("Devam etmek için bir tuşa bas",t/2,l/2+35),e.restore()}function _e(e,t,l,a,i,r,n){e.save(),e.globalAlpha=Math.min(1,n),e.fillStyle=s.bg,e.fillRect(0,0,t,l),e.textAlign="center",e.textBaseline="middle";const o=8,y=4,f=H*o+(H-1)*y,h=(t-f)/2,g=l/2-55;for(let k=0;k<H;k++){const S=h+k*(o+y);k<a?(e.fillStyle=s.gold,e.fillRect(S,g,o,o)):(e.strokeStyle=s.textDim,e.lineWidth=1,e.strokeRect(S+.5,g+.5,o-1,o-1))}e.fillStyle=s.text,e.font="bold 13px monospace",e.fillText(i,t/2,l/2-10),e.fillStyle=s.textDim,e.font="9px monospace",e.fillText(r,t/2,l/2+12),e.fillStyle=s.playerHeart;const m=60*n;e.fillRect(t/2-m/2,l/2-22,m,1),e.globalAlpha=1,e.restore()}function Ke(e,t,l,a,i){e.save(),e.fillStyle="rgba(242, 232, 220, 0.8)",e.fillRect(0,0,t,l),e.globalAlpha=Math.min(1,i),e.textAlign="center",e.textBaseline="middle",e.fillStyle=s.playerHeart,e.font="bold 13px monospace",e.fillText("BÖLÜM "+a+" TAMAMLANDI!",t/2,l/2-10);const r=8;for(let n=0;n<r;n++){const o=n/r*Math.PI*2,y=30+i*40,f=t/2+Math.cos(o)*y,h=l/2+Math.sin(o)*y-10,g=1+Math.floor(i*2),m=n%2===0?s.gold:s.playerHeart;He(e,Math.floor(f),Math.floor(h),g,m)}for(let n=0;n<4;n++){const o=n/4*Math.PI*2+Math.PI/4,y=20+i*30,f=t/2+Math.cos(o)*y-3,h=l/2+Math.sin(o)*y-12;W(e,Math.floor(f),Math.floor(h),3,s.playerHeart)}e.globalAlpha=1,e.restore()}function se(e,t,l){e.save(),e.globalAlpha=.7;const a=8,i=4,n=(480-(H*a+(H-1)*i))/2,o=6;for(let y=0;y<H;y++){const f=n+y*(a+i);y<t?(e.fillStyle=s.gold,e.fillRect(f,o,a,a)):(e.strokeStyle=s.textDim,e.lineWidth=1,e.strokeRect(f+.5,o+.5,a-1,a-1))}Fe(e,8,5,s.text),e.fillStyle=s.text,e.font="8px monospace",e.textAlign="left",e.textBaseline="top",e.fillText(""+l,16,6),e.globalAlpha=1,e.restore()}function Ye(e,t,l,a){e.save(),e.fillStyle=s.bg,e.fillRect(0,0,t,l);const i=l/2+40;e.fillStyle=s.platform,e.fillRect(0,i,t,4);const r=t/2,n=i-16;if(a<=120){const o=Math.min(1,a/120),y=1-Math.pow(1-o,2),f=-14+y*(r-20),h=t+y*-246,g=q(Math.floor(f),Math.floor(n));g.facingRight=!0,g.onGround=!0,g.animFrame=Math.floor(a/8)%4,V(e,g);const m=Math.floor(a/10)%4;F(e,Math.floor(h),Math.floor(n),m)}if(a>120&&a<=180){const o=q(Math.floor(r-20),Math.floor(n));o.facingRight=!0,o.onGround=!0,o.animFrame=0,V(e,o),F(e,Math.floor(r+6),Math.floor(n),1);const y=(a-120)/60,f=10;for(let h=0;h<f;h++){const g=h/f*Math.PI*2,m=y*60,k=r+Math.cos(g)*m-3,S=n-5+Math.sin(g)*m*.7,U=Math.max(0,1-y*.5);e.globalAlpha=U;const z=h%3===0?4:3,ge=h%2===0?s.playerHeart:s.princess;W(e,Math.floor(k),Math.floor(S),z,ge)}e.globalAlpha=1}if(a>180){const o=q(Math.floor(r-20),Math.floor(n));o.facingRight=!0,o.onGround=!0,o.animFrame=0,V(e,o),F(e,Math.floor(r+6),Math.floor(n),Math.floor(a/20)%4);for(let m=0;m<6;m++){const k=m/6*Math.PI*2+a*.01,S=25+Math.sin(a*.03+m)*10,U=r+Math.cos(k)*S-3,z=n-10+Math.sin(k)*S*.5;e.globalAlpha=.5+Math.sin(a*.05+m)*.3,W(e,Math.floor(U),Math.floor(z),2,s.playerHeart)}e.globalAlpha=1;const y=Math.min(1,(a-180)/60);e.textAlign="center",e.textBaseline="middle",e.globalAlpha=y,e.fillStyle=s.playerHeart,e.font="bold 14px monospace",e.fillText("Prensesine kavuştun!",t/2,l/2+65);const f=Math.min(1,Math.max(0,(a-210)/60));e.globalAlpha=f,e.fillStyle=s.text,e.font="10px monospace",e.fillText("Her engeli aştım, çünkü sonunda sen varsın.",t/2,l/2+82);const h=Math.min(1,Math.max(0,(a-250)/60));e.globalAlpha=h,e.fillStyle=s.gold,e.font="bold 11px monospace",e.fillText("Sevgililer Günün Kutlu Olsun, Işıl'ım ❤",t/2,l/2+98);const g=Math.min(1,Math.max(0,(a-310)/60));e.globalAlpha=g,e.fillStyle=s.textDim,e.font="8px monospace",e.fillText("Tekrar Oyna (R)",t/2,l/2+118),e.globalAlpha=1}e.restore()}let Q=null;function ce(){return Q||(Q=new AudioContext),Q}function qe(){const e=ce();e.state==="suspended"&&e.resume()}function M(e,t,l="square",a=.15){const i=ce(),r=i.createOscillator(),n=i.createGain();r.type=l,r.frequency.value=e,n.gain.setValueAtTime(a,i.currentTime),n.gain.exponentialRampToValueAtTime(.001,i.currentTime+t),r.connect(n).connect(i.destination),r.start(),r.stop(i.currentTime+t)}function Ve(){M(300,.1),setTimeout(()=>M(450,.1),50)}function We(){M(400,.15),setTimeout(()=>M(250,.15),100),setTimeout(()=>M(150,.3),200)}function T(){M(200,.05,"sawtooth",.2),setTimeout(()=>M(150,.05,"sawtooth",.2),60)}function je(){[0,80,160,240].forEach((e,t)=>setTimeout(()=>M(400+t*100,.15),e))}function Ne(){[523,659,784,1047].forEach((t,l)=>setTimeout(()=>M(t,.2,"square",.12),l*120))}function Xe(e){return e.map(t=>({def:t,active:!0,timer:0,triggered:!1,collapsed:!1,doorMoveProgress:0,spikeOut:!1,gravityFlipped:!1,shaking:!1}))}function Ze(e,t,l,a,i){let r=!1,n={...a};for(const o of e){if(!o.active)continue;const y={x:t.x,y:t.y,w:t.w,h:t.h};switch(o.def.type){case"collapse":{if(!o.triggered){const f={x:o.def.rect.x,y:o.def.rect.y-4,w:o.def.rect.w,h:6};v(y,f)&&t.onGround&&(o.triggered=!0,o.timer=0,o.shaking=!0)}if(o.triggered&&!o.collapsed&&(o.timer+=i,o.timer>(o.def.delay??.5))){o.collapsed=!0,o.shaking=!1,T();const f=l.findIndex(h=>h.x===o.def.rect.x&&h.y===o.def.rect.y&&h.w===o.def.rect.w&&h.h===o.def.rect.h);f>=0&&l.splice(f,1)}break}case"spike":{if(!o.triggered){const f={x:o.def.rect.x-30,y:o.def.rect.y-40,w:o.def.rect.w+60,h:o.def.rect.h+40};v(y,f)&&(o.triggered=!0,o.timer=0)}o.triggered&&(o.timer+=i,o.timer>.2&&!o.spikeOut&&(o.spikeOut=!0,T()),o.spikeOut&&v(y,o.def.rect)&&(r=!0));break}case"moveDoor":{if(!o.triggered){const f={x:n.x-40,y:0,w:80,h:270};v(y,f)&&(o.triggered=!0,o.timer=0,T())}if(o.triggered&&o.def.target){o.doorMoveProgress=Math.min(1,o.doorMoveProgress+i*3);const f=Ue(o.doorMoveProgress);n={x:a.x+(o.def.target.x-a.x)*f,y:a.y+(o.def.target.y-a.y)*f},o.doorMoveProgress>=1&&(o.active=!1,a.x=o.def.target.x,a.y=o.def.target.y,n={...a})}break}case"gravityFlip":{!o.triggered&&v(y,o.def.rect)&&(o.triggered=!0,t.gravityDir=t.gravityDir===1?-1:1,t.vy=0,T());break}case"boost":{if(v(y,o.def.rect)&&!o.triggered){o.triggered=!0,T();const f=t.facingRight?1:-1;t.boostVx=f*300,t.onGround&&(t.vy=-100*t.gravityDir)}o.triggered&&!v(y,o.def.rect)&&(o.triggered=!1);break}case"fakeExit":{if(!o.triggered&&v(y,o.def.rect)&&(o.triggered=!0,o.timer=0,T()),o.triggered&&!o.collapsed&&(o.timer+=i,o.timer>1.5)){o.collapsed=!0;for(let f=l.length-1;f>=0;f--){const h=l[f];Math.abs(h.x-o.def.rect.x)<150&&h.y>200&&l.splice(f,1)}}break}}}return{killedPlayer:r,doorPos:n}}function Ue(e){return e*(2-e)}const u=480,p=270,G=document.getElementById("game"),ze=G.getContext("2d");function ue(){const e=window.innerWidth,t=window.innerHeight,l=Math.min(e/u,t/p);G.width=u,G.height=p,G.style.width=`${Math.floor(u*l)}px`,G.style.height=`${Math.floor(p*l)}px`}ue();window.addEventListener("resize",ue);we(G);let _="start",D=0,K=0,B=0,te=0,x=0,pe="",fe=!1,c=q(0,0),E=[],d={x:0,y:0},Y=[],ee=0,O=0,ye=!1,L=0,b=0,A=0,I=[],R=!1,X=!1;window.addEventListener("keydown",()=>{R=!0});function me(e){const t=Z[e];E=t.platforms.map(l=>({...l})),c=q(t.playerStart.x,t.playerStart.y),d={...t.doorPos},Y=Xe(Z[e].traps),B=0}function P(e){if(_=e,B=0,e==="levelIntro"&&(me(D),b=1,A=-1),e==="dead"){pe=ne[Math.floor(Math.random()*ne.length)],K++,We(),X=!1,L=.3;for(let t=0;t<8;t++)I.push({x:c.x+c.w/2,y:c.y+c.h/2,vx:(Math.random()-.5)*60,vy:-30-Math.random()*50,life:1+Math.random()*.5,maxLife:1.5,color:Math.random()>.5?"#e8b4c8":"#f0c888"})}if(e==="levelClear"){je(),Ne();for(let t=0;t<14;t++){const l=[s.playerHeart,s.gold,s.princess,"#f0c888"];I.push({x:d.x+8+(Math.random()-.5)*40,y:d.y+12,vx:(Math.random()-.5)*80,vy:-50-Math.random()*80,life:1.5+Math.random()*1,maxLife:2.5,color:l[Math.floor(Math.random()*l.length)]})}}e==="finale"&&(te=0)}function Je(){return{x:d.x,y:d.y,w:16,h:24}}function $e(){return{x:c.x,y:c.y,w:c.w,h:c.h}}De(ze,e=>{switch(B+=e,x++,_){case"start":{R&&(R=!1,fe||(qe(),fe=!0),D=0,P("levelIntro"));break}case"levelIntro":{B>=2&&(_="playing",B=0,R=!1);break}case"playing":{ke(c,e,E),ye&&!c.onGround&&c.vy<0&&Ve(),ye=c.onGround;const t=Ze(Y,c,E,d,e);if(d=t.doorPos,t.killedPlayer&&(c.alive=!1),ee+=e,ee>.3&&(ee=0,O=(O+1)%4),!c.alive){P("dead");break}if(v($e(),Je())){P("levelClear");break}R=!1;break}case"dead":{B>.3&&(X=!0),X&&R&&(R=!1,X=!1,me(D),_="playing",B=0);break}case"levelClear":{B>=1.5&&A===0&&(A=1),B>=2&&(D+1<Z.length?(D++,P("levelIntro")):P("finale"));break}case"finale":{te++,w.KeyR&&(D=0,K=0,P("levelIntro")),w.KeyM&&(window.location.href="/"),R=!1;break}}L>0&&(L-=e),A!==0&&(b+=A*e*2.5,b<=0&&(b=0,A=0),b>=1&&(b=1,A=0));for(let t=I.length-1;t>=0;t--){const l=I[t];l.x+=l.vx*e,l.y+=l.vy*e,l.vy+=40*e,l.life-=e,l.life<=0&&I.splice(t,1)}},e=>{if(e.fillStyle=s.bg,e.fillRect(0,0,u,p),L>0){const t=L/.3*4;e.save(),e.translate((Math.random()-.5)*t,(Math.random()-.5)*t)}switch(_){case"start":{Ce(e,u,p,x);break}case"levelIntro":{const t=Z[D],l=Math.min(1,B/2);_e(e,u,p,D+1,t.name,t.subtitle,l);break}case"playing":{for(const t of E)C(e,t);for(const t of Y){if(t.def.type==="spike"&&t.spikeOut&&ie(e,t.def.rect.x,t.def.rect.y),t.shaking&&!t.collapsed){const l=(Math.random()-.5)*3,a=(Math.random()-.5)*2;e.save(),e.translate(l,a),C(e,t.def.rect),e.restore()}t.def.type==="fakeExit"&&t.triggered&&!t.collapsed&&(e.fillStyle=s.gold,e.font="bold 14px monospace",e.textAlign="center",e.fillText("Tebrikler!",u/2,p/2-20))}for(const t of Y)t.def.type==="boost"&&Ie(e,t.def.rect.x,t.def.rect.y,t.def.rect.w,t.def.rect.h,x);$(e,d.x,d.y,!1),F(e,d.x-18,d.y-2,O),V(e,c),se(e,D+1,K),N(e,u,p);break}case"dead":{for(const t of E)C(e,t);for(const t of Y){if(t.def.type==="spike"&&t.spikeOut&&ie(e,t.def.rect.x,t.def.rect.y),t.shaking&&!t.collapsed){const l=(Math.random()-.5)*3,a=(Math.random()-.5)*2;e.save(),e.translate(l,a),C(e,t.def.rect),e.restore()}t.def.type==="fakeExit"&&t.triggered&&!t.collapsed&&(e.fillStyle=s.gold,e.font="bold 14px monospace",e.textAlign="center",e.fillText("Tebrikler!",u/2,p/2-20))}$(e,d.x,d.y,!1),F(e,d.x-18,d.y-2,O),se(e,D+1,K),N(e,u,p),Oe(e,u,p,pe,K);break}case"levelClear":{for(const l of E)C(e,l);$(e,d.x,d.y,!0),F(e,d.x-18,d.y-2,O),V(e,c),N(e,u,p);const t=Math.min(1,B/2);Ke(e,u,p,D+1,t);break}case"finale":{Ye(e,u,p,te),N(e,u,p);break}}for(const t of I){const l=Math.max(0,t.life/t.maxLife);e.globalAlpha=l,W(e,t.x-4,t.y-3,2,t.color)}e.globalAlpha=1,b>0&&(e.fillStyle=`rgba(242, 232, 220, ${b})`,e.fillRect(0,0,u,p)),L>0&&e.restore()});
